---
id: cses-1740
source: CSES
title: Intersection Points
author: Rameez Parwez
---

[Offical Editorial](https://usaco.guide/CPH.pdf#page=286)

## Implementation

**Time Complexity:** $mathcal{O}(N\log N)$

<LanguageSection>
<CPPSection>

```cpp
#include <bits/stdc++.h>

#define ll long long
using namespace std;

const int INF = 1e6 + 1;
const int MAX_N = 1e5 + 1;
const int MAX_D = 2e6 + 1;

pair<int, int> vertical[MAX_N];
int y_cord[MAX_N];

// BeginCodeSnip{Fenwick Tree}
struct Fenwick {
	const int n;
	vector<ll> bit;
	Fenwick(int n) : n(n), bit(n, 0) {}

	void add(int x, int v) {
		for (; x < n; x += (x & -x)) { bit[x] += v; }
	}

	ll query(int x) {
		ll res = 0;
		for (; x > 0; x -= (x & -x)) { res += bit[x]; }
		return res;
	}
};
// EndCodeSnip

int main() {
	int n;
	cin >> n;
	vector<tuple<int, int, int>> points;

	for (int i = 0; i < n; i++) {
		int x1, y1, x2, y2;
		cin >> x1 >> y1 >> x2 >> y2;
		if (x1 == x2) {  // vertical line
			points.push_back({x1, 2, i});
			vertical[i] = {y1, y2};
		} else {  // horizontal line
			points.push_back({x1, 1, i});
			points.push_back({x2, 3, i});
			y_cord[i] = y1;
		}
	}

	sort(begin(points), end(points));
	ll res = 0;
	Fenwick bit(MAX_D);

	for (auto &[x, event, i] : points) {
		if (event == 1) {
			bit.add(y_cord[i] + INF, 1);
		} else if (event == 3) {
			bit.add(y_cord[i] + INF, -1);
		} else {
			res += bit.query(vertical[i].second + INF) -
			       bit.query(vertical[i].first + INF - 1);
		}
	}
	cout << res << '\n';
}
```

</CPPSection>
</LanguageSection>
